<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.52" />
  <meta name="author" content="Lucas van Dijk">
  
  
  
  
    
      
    
  
  <meta name="description" content="This is a library which allows programs running in the userspace to control the TLC5940 LED driver with a Raspberry Pi. The user can specify the PWM value for each output channel of the TLC5940, and it also supports multiple cascaded TLC5940&rsquo;s.
The TLC5940 The TLC5940 is a versatile LED driver from Texas Instruments. It has 16 output channels, and they can be cascaded to easily support more output channels.">

  
  <link rel="alternate" hreflang="en-us" href="https://lucasvandijk.nl/project/raspberry-pi-tlc5940/">

  


  

  
  
  <meta name="theme-color" content="#268bd2">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:300,400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  

  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>


  
  <link rel="alternate" href="https://lucasvandijk.nl/index.xml" type="application/rss+xml" title="Lucas van Dijk">
  <link rel="feed" href="https://lucasvandijk.nl/index.xml" type="application/rss+xml" title="Lucas van Dijk">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://lucasvandijk.nl/project/raspberry-pi-tlc5940/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@lucasvandijk">
  <meta property="twitter:creator" content="@lucasvandijk">
  
  <meta property="og:site_name" content="Lucas van Dijk">
  <meta property="og:url" content="https://lucasvandijk.nl/project/raspberry-pi-tlc5940/">
  <meta property="og:title" content="Raspberry Pi TLC5940 library | Lucas van Dijk">
  <meta property="og:description" content="This is a library which allows programs running in the userspace to control the TLC5940 LED driver with a Raspberry Pi. The user can specify the PWM value for each output channel of the TLC5940, and it also supports multiple cascaded TLC5940&rsquo;s.
The TLC5940 The TLC5940 is a versatile LED driver from Texas Instruments. It has 16 output channels, and they can be cascaded to easily support more output channels."><meta property="og:image" content="https://lucasvandijk.nl/img/projectimages/ledcube-full.jpg">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2013-04-01T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2013-04-01T00:00:00&#43;00:00">
  

  

  <title>Raspberry Pi TLC5940 library | Lucas van Dijk</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="76" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="row">
      <div class="navbar-header col-lg-3">
        
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                                              data-target=".navbar-collapse" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="/"><span class="top">Lucas</span> <span class="bottom">van Dijk</span></a>
      </div>

      
      <div class="collapse navbar-collapse">

        
        
        <ul class="nav navbar-nav navbar-right">
          

          

          
          

          <li class="nav-item">
            <a href="/">
              
              <span>Home</span>
              
            </a>
          </li>

          
          

          

          
          
            
          

          <li class="nav-item">
            <a href="/#blog">
              
              <span>Blog</span>
              
            </a>
          </li>

          
          

          

          
          
            
          

          <li class="nav-item">
            <a href="/#projects">
              
              <span>Software</span>
              
            </a>
          </li>

          
          
          

        
        </ul>

      </div>
    </div> 
  </div>
</nav>


<article class="article article-project" itemscope itemtype="http://schema.org/Article">

    <div class="article-header">

  <img src="/img/projectimages/ledcube-full.jpg" class="article-banner" itemprop="image">
  <span class="article-header-caption">An 8x8x8 LED cube powered by several TLC5940 LED drivers</span>

</div>

    

    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="pub-title">
                    <h1 itemprop="name">Raspberry Pi TLC5940 library</h1>
                    <span class="pub-authors" itemprop="author">&nbsp;</span>
                </div>
            </div>
        </div>
        <div class="row">
            <aside class="col-xs-12 col-sm-12 col-md-3 pull-right quick-info">
                <div class="row">
                    <div class="col-xs-6 col-sm-6 col-md-12">
                        <h2>Quick Info</h2>
                        <p>
                            
                            <strong>Status:</strong> Mature, development discontinued<br>
                            
                            
                            <strong>License:</strong>
                            
                            <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopenener">MIT</a>
                            
                            <br>
                            
                        </p>
                        <h2>Share</h2>
                        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Raspberry%20Pi%20TLC5940%20library&amp;url=https%3a%2f%2flucasvandijk.nl%2fproject%2fraspberry-pi-tlc5940%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2flucasvandijk.nl%2fproject%2fraspberry-pi-tlc5940%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flucasvandijk.nl%2fproject%2fraspberry-pi-tlc5940%2f&amp;title=Raspberry%20Pi%20TLC5940%20library"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2flucasvandijk.nl%2fproject%2fraspberry-pi-tlc5940%2f&amp;title=Raspberry%20Pi%20TLC5940%20library"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Raspberry%20Pi%20TLC5940%20library&amp;body=https%3a%2f%2flucasvandijk.nl%2fproject%2fraspberry-pi-tlc5940%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


                    </div>

                    
                    <div class="col-xs-6 col-sm-6 col-md-12">
                        <h2>On Github</h2>
                        
                        <p>
                            <span class="fa fa-lg fa-github"></span>
                            <a href="https://github.com/lrvdijk/tlc5940-raspberry" target="_blank" rel="noopener">lrvdijk/tlc5940-raspberry</a>
                        </p>
                        <p>
                            <a class="github-button" href="https://github.com/lrvdijk/tlc5940-raspberry" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star lrvdijk/tlc5940-raspberry on GitHub">Star</a>
                            
                        </p>
                        
                    </div>
                    
                </div>

            </aside>

            <div class="col-xs-12 col-sm-12 col-md-9">
                

                <div class="article-style" itemprop="articleBody">
                    

<p>This is a library which allows programs running in the userspace
to control the TLC5940 LED driver with a Raspberry Pi. The user
can specify the PWM value for each output channel of the TLC5940,
and it also supports multiple cascaded TLC5940&rsquo;s.</p>

<h2 id="the-tlc5940">The TLC5940</h2>

<p>The <a href="http://ti.com/product/tlc5940" target="_blank">TLC5940</a> is a versatile LED driver from Texas Instruments. It has
16 output channels, and they can be cascaded to easily support more
output channels. The TLC5940 has a 12 bit register for each output channel.
The value in each register determines the time a certain channel is enabled.
This allows pulse width modulation for all of the 16 channels.</p>

<p>To drive the outputs, the user of the chip should provide a clock signal on
the <code>GSCLK</code> pin of the TLC5940. On each pulse, an internal counter is incremented,
and the value in each register of the output channels is compared to the value
of the internal counter. If the value in the register is equal to the value of
the counter, then the channel will be disabled for the rest of the cycle. If the
counter reaches the maximum value of an unsigned 12 bit integer (4095), the
user needs to send a pulse on the <code>blank</code> pin to reset the counter.</p>

<p>The important thing to note here, is that the TLC5940 constantly needs a clock
signal on <code>GSCLK</code>, without a signal, it won&rsquo;t update the output channels. A stable
and fast clock will result in a stable and clear PWM signal. This is a little
inconvenient for us. Because most people have Linux on their Raspberry Pi, and
because Linux is a General Purpose operating system, providing a stable clock
from pure software is hard.</p>

<p>The program driving the TLC5940 is not the only process running on the Raspberry
Pi. Each running program needs to share the ARM processor with the others. Because
of that, sometimes the execution of the program driving the TLC5940 gets paused,
to give an other process the processor. And with our process paused, the <code>GSCLK</code>
signal generation gets also paused, resulting is a less stable PWM signal.</p>

<p>This is a bit hard to fix, because you need to keep track of the pulse count,
to send a pulse to the <code>blank</code> pin on the right moment. Any suggestions for
solutions are always welcome.</p>

<h2 id="documentation">Documentation</h2>

<p>Because the TLC5940 constantly needs a stable clock, multithreading is a must
in your program. You need one thread which determines which outputs
need what value, and stores that in a buffer. The other thread constantly
reads that buffer and sends the data to the TLC5940. Please view the provided
sample program for a simple example. Luckily, multithreading isn&rsquo;t that hard
anymore with C++11. For a simple introduction, check <a href="/2012/05/introduction-to-threads-with-c-11/" target="_blank">this tutorial</a>.</p>

<h3 id="tutorial">Tutorial</h3>

<p>First you need to decide which pins you&rsquo;re going to use on the Raspberry Pi.
Please take a look at the <a href="https://projects.drogon.net/raspberry-pi/wiringpi/pins/" target="_blank">wiringPi site</a> with all the pin numbers. To
control your TLC5940, you&rsquo;ll need 7 GPIO pins. If you&rsquo;re not going to use the
&ldquo;Dot Correction&rdquo; feature of the TLC5940, you&rsquo;ll need 5. Dot correction is also
not supported in this library for now, but it will probably in the future.
Below is the list of the pins on the TLC5940 which need to be controlled by the
Raspberry Pi.</p>

<ul>
<li>SIN</li>
<li>SCLK</li>
<li>BLANK</li>
<li>XLAT</li>
<li>GSPRG</li>
<li>DCPRG (connect to ground if not using Dot Correction)</li>
<li>VPRG (connect to ground if not using Dot Correction)</li>
</ul>

<p>You&rsquo;re free to choose any pin on the Raspberry Pi, but keep the <a href="https://projects.drogon.net/raspberry-pi/wiringpi/special-pin-functions/" target="_blank">special pin functions</a>
in mind. Define the pins in your code using multiple instances of the class
<code>RaspberryGPIOPin</code>:</p>

<pre><code class="language-cpp">RaspberryGPIOPin tlc_sin(1);
RaspberryGPIOPin tlc_sclk(14);
RaspberryGPIOPin tlc_blank(4);
RaspberryGPIOPin tlc_dcprg(5);
RaspberryGPIOPin tlc_vprg(6); 
RaspberryGPIOPin tlc_xlat(10);
RaspberryGPIOPin tlc_gsclk(11);

tlc_sin.setOutput();
tlc_sclk.setOutput();
tlc_blank.setOutput();
tlc_dcprg.setOutput();
tlc_vprg.setOutput();
tlc_xlat.setOutput();
tlc_gsclk.setOutput();
</code></pre>

<p>The number given with the <code>RaspberryGPIOPin</code> constructor represents the <strong>wiringPi
pin number</strong>, not the BCM GPIO number. See the wiringPi site for the numbers.</p>

<p>Controlling the TLC5940 starts with an instance of the class TLCController. This
class needs a template parameter, containing the number of cascaded TLC5940 chips.
The class also needs to know which pins you&rsquo;re going to use, so the GPIO pin instances
created above are passed along.</p>

<pre><code class="language-cpp">TLCController&lt;2&gt; tlc_controller(&amp;tlc_sin, &amp;tlc_sclk, &amp;tlc_blank, &amp;tlc_dcprg, &amp;tlc_vprg, &amp;tlc_xlat, &amp;tlc_gsclk);
</code></pre>

<p>If you have just a single TLC5940, you can use the SingleTLCController class.</p>

<p>To enable an output, you use the <code>setChannel</code> method. <code>setall</code> sets the specified value
for all channels.</p>

<pre><code class="language-cpp">tlc_controller.setChannel(0, 2048); // Set channel 0 to half of the brightness
tlc_controller.setChannel(1, 4095); // Set channel 1 to full brightness
</code></pre>

<p>Using the <code>update</code> method, the data is sent to the TLC5940. Remember, this function
needs to be called continuously, even if you don&rsquo;t changed any output values.</p>

<pre><code class="language-cpp">tlc_controller.update();
</code></pre>

<h3 id="linking">Linking</h3>

<p>This library provides a <code>pkg-config</code> configuration file, so you can use pkg-config
to retrieve the required compiler and linker flags.</p>

<pre><code class="language-bash">CFLAGS += `pkg-config --cflags tlc5940-raspberry-1.0`
LDFLAGS += `pkg-config --libs tlc5940-raspberry-1.0`
</code></pre>

<p>And if you use autotools as build system you can use the <code>PKG_CHECK_MODULES</code> macro,
see <a href="http://www.flameeyes.eu/autotools-mythbuster/pkgconfig/pkg_check_modules.html" target="_blank">this</a> site for more info.</p>

<h2 id="download-and-install">Download and Install</h2>

<p>This project is hosted on <a href="https://github.com/lrvdijk/tlc5940-raspberry" target="_blank">Github</a>. To get the latest version you can use Git to clone the repository.</p>

<p><code>git clone http://github.com/lrvdijk/tlc5940-raspberry</code></p>

<p>Or you can just download the code <a href="https://github.com/lrvdijk/tlc5940-raspberry/archive/master.zip" target="_blank">from here</a>.</p>

<h3 id="installation">Installation</h3>

<p>Download the latest version on your Raspberry Pi, and extract its contents.
Navigate to the right folder, and execute the following commands:</p>

<pre><code class="language-bash">./autogen --prefix=/usr
make
sudo make install
</code></pre>

<p>It&rsquo;s better to install the library in /usr instead of the default /usr/local,
because by default <code>pkg-config</code> doesn&rsquo;t check the /usr/local folders for
package config files.</p>

                </div>

                


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/electronics">electronics</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/c&#43;&#43;">C&#43;&#43;</a>
  
</div>




                
                

                
                
                
                
                

                
                
                
                
                

                
<section id="comments">
  <form>
  <div class="checkbox">
    <label for="enable_comments">
      <input type="checkbox" name="enable_comments" id="enable_comments"> 
      Enable comments
    </label>
  </div>
  <p>
    We use <a href="https://disqus.com" target="_blank">Disqus</a> for comments.
    By enabling comments you agree that third party services may place tracking
    cookies on your computer. Disqus allows you to opt out from data sharing 
    <a href="https://help.disqus.com/customer/portal/articles/1657951-data-sharing-settings" target="_blank">
      on this page
    </a>.
  </p>
</form>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</section>


            </div>
        </div>
    </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Lucas van Dijk &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    

    <script src="/js/hugo-academic.js"></script>
    

    

    
    <script type="text/javascript">
    window.disqus_short_name = 'return1';
    </script>
    <script type="text/javascript" src="/js/comments.js"></script>
    

    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

